$(function () {
    lenisSetup()
    replaceHash();
    cursor();
    searchBox()
    AOS.init({
        duration: 1200,
        disable: "mobile",
    });
    $(document).ready(function(){
        $("#carouselExampleCaptions").carousel({
            interval : 3250
        });
   });
    numCounter();
});

function numCounter() {
    $('.number .minus').click(function () {
        var $input = $(this).parent().find('input');
        var count = parseInt($input.val()) - 1;
        count = count < 1 ? 1 : count;
        $input.val(count);
        $input.change();
        return false;
    });
    $('.number .plus').click(function () {
        var $input = $(this).parent().find('input');
        $input.val(parseInt($input.val()) + 1);
        $input.change();
        return false;
    });
}

function searchBox() {
    $('a[href="#search"]').on('click', function(event) {
        event.preventDefault();
        $('#search').addClass('open');
        $('#search > form > input[type="search"]').focus();
    });

    $('#search, #search button.close').on('click keyup', function(event) {
        if (event.target == this || event.target.className == 'close' || event.keyCode == 27) {
            $(this).removeClass('open');
        }
    });
}

function cursor() {
    const cursor = document.querySelector("#cursor-follow");
    document.addEventListener("mousemove", (e) => {
        gsap.to(cursor, {
            scale: e.target.tagName.toLowerCase() === "a" ||
                e.target.tagName.toLowerCase() === "button" ?
                2 :
                1,
            x: e.clientX,
            y: e.clientY,
            duration: 0.2,
        });
    });
}

function replaceHash() {
    document.querySelectorAll("a").forEach((a) => {
        let href = a.getAttribute("href");
        a.href = href ?
            href.startsWith("#") && href.endsWith("#") ?
            href.replace("#", "javascript:void(0)") :
            href :
            "javascript:void(0)";
    });
}

function lenisSetup() {
    const lenis = new Lenis({
        duration: 1.5,
        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
        smooth: true,
        mouseMultiplier: 1,
    })

    function raf(time) {
        lenis.raf(time)
        requestAnimationFrame(raf)
    }

    requestAnimationFrame(raf);
    document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            lenis.scrollTo(this.getAttribute("href"));
        });
    });
}